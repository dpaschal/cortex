# Cortex Configuration
# Default configuration file

cluster:
  # Unique identifier for this cluster
  id: cortex-default

  # Auto-approve ALL new nodes (for development/testing)
  autoApprove: true

  # Auto-approve new nodes with these tags
  autoApproveTags:
    - tag:cortex-trusted

  # Auto-approve ephemeral (PXE-booted) nodes
  autoApproveEphemeral: true

node:
  # gRPC server port
  grpcPort: 50051

  # Node role: leader-eligible or worker
  # leader-eligible nodes participate in Raft consensus
  # worker nodes only execute tasks
  role: leader-eligible

  # Tags for this node
  tags: []

network:
  # Tailscale tag for cluster discovery
  tailscaleTag: cortex

  # Discovery poll interval
  discoveryIntervalMs: 30000

raft:
  # Election timeout range (randomized within this range)
  # Wide range to prevent split votes between nodes
  electionTimeoutMinMs: 2000
  electionTimeoutMaxMs: 5000

  # Heartbeat interval (must be much less than election timeout)
  heartbeatIntervalMs: 500

  # Maximum log entries per AppendEntries RPC
  maxLogEntriesPerAppend: 100

scheduler:
  # Maximum tasks in queue
  maxQueueSize: 1000

  # Maximum retry attempts for failed tasks
  maxRetries: 3

  # Scheduling interval
  schedulingIntervalMs: 1000

resources:
  # Resource monitoring poll interval
  pollIntervalMs: 5000

  # Gaming detection settings
  gaming:
    # Process names that indicate gaming activity
    processes:
      - steam
      - steamwebhelper
      - wine
      - wine64
      - wineserver
      - proton
      - pressure-vessel
      - gamescope
      - gamemode
      - lutris
      - heroic

    # GPU utilization threshold for gaming detection
    gpuThreshold: 70

    # Cooldown after gaming stops before resuming GPU tasks
    cooldownMs: 30000

health:
  # Health check interval
  checkIntervalMs: 10000

  # Resource thresholds for health warnings
  thresholds:
    memoryPercent: 90
    cpuPercent: 95
    diskPercent: 95

kubernetes:
  # Path to kubeconfig file (null for default location)
  kubeconfigPath: null

  # Default namespace for jobs
  defaultNamespace: default

  # TTL for completed jobs
  jobTtlSeconds: 3600

security:
  # Directory for certificates
  certsDir: ~/.cortex/certs

  # Directory for secrets
  secretsDir: ~/.cortex/secrets

  # Enable mTLS for gRPC
  enableMtls: false

  # Approval request timeout
  approvalTimeoutMs: 300000  # 5 minutes

logging:
  # Log level: error, warn, info, debug
  level: info

  # Log format: json or simple
  format: simple

  # Log file (null for stdout only)
  file: null

mcp:
  # MCP server settings
  serverName: cortex
  serverVersion: "0.1.0"

# Shared memory database (Raft-replicated SQLite)
sharedMemory:
  # Enable shared memory (set false to use legacy PostgreSQL tools)
  enabled: true

  # Data directory for shared-memory.db
  dataDir: ~/.cortex

  # Integrity check interval (milliseconds, 0 to disable)
  integrityCheckIntervalMs: 300000  # 5 minutes

  # Litestream backup (leader only)
  backup:
    enabled: false
    bucket: paschal-homelab-backups
    path: cortex/shared-memory/

# Messaging gateway (absorbed from OpenClaw)
messaging:
  enabled: false
  agent: "Cipher"
  inboxPath: ~/.cortex/inbox
  channels:
    discord:
      enabled: false
      token: ""
      guildId: ""
    telegram:
      enabled: false
      token: ""

# LLM provider routing (multi-provider with fallback)
providers:
  primary: anthropic
  fallback:
    - ollama
  anthropic:
    model: claude-sonnet-4-6
    apiKey: ""
  openai:
    model: gpt-4o
    apiKey: ""
  ollama:
    model: llama3
    baseUrl: http://localhost:11434

# SKILL.md skill system
skills:
  enabled: false
  directories:
    - ~/.cortex/skills
  hotReload: false

# Plugin configuration â€” per-node enable/disable. Restart required.
plugins:
  memory:
    enabled: true
  cluster-tools:
    enabled: true
  resource-monitor:
    enabled: true
  updater:
    enabled: true
  skills:
    enabled: false
    directories:
      - ~/.cortex/skills
  messaging:
    enabled: false
    agent: "Cipher"
    inboxPath: ~/.cortex/inbox
  kubernetes:
    enabled: false

# Initial seed nodes for joining an existing cluster
# NOTE: Don't list ALL nodes here - list nodes that should already be running
# The first node to start becomes leader, others join via seeds
seeds: []
  # - address: 100.104.78.123:50051  # rog2
  # - address: 100.120.202.76:50051  # terminus-1
